<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Title</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>

<section class="cart">
  <div class="container my-5 px-md-5 px-4">
    <div class="row justify-content-between">
      <h1 class="col-auto">Your cart</h1>
      <div class="col-auto">
        <div class="row justify-content-end">
          <a href="/products" class="col d-block">Continue shopping</a>
        </div>
      </div>
    </div>

    <table class="table">
      <thead>
      <div class="row justify-content-between my-4">
        <p class="col-auto">PRODUCT</p>
        <p class="col-auto">TOTAL</p>
      </div>
      </thead>
      <tbody class="table-group-divider">
      <div th:if="${cartList.size() == 0}"><h2>Your cart is empty!</h2></div>
      <div th:if="${cartList.size() > 0}" th:each="cartItem : ${cartList}">
        <tr class="row">
          <td class="col-8">
            <div class="card mb-3">
              <div class="row row-cols-2 align-items-center g-0">
                <div class="col-md-4 w-25">
                  <img
                          th:src="${cartItem.getKey().image}"
                          class="img-fluid rounded-start"
                          alt="..."
                  />
                </div>
                <div class="col-md-8 w-75">
                  <div class="card-body">
                    <div class="card-title">
                      <a class="link link-offset-2-hover text-black fs-5"
                         href="/products?action=details&id=${cart.getProductId()}"
                         th:text=" ${cartItem.getKey().name}"
                      >
                      </a>
                    </div>
                    <p class="card-text">€<span th:text="${cartItem.getKey().price}" class="price"></span> EUR</p>
                    <p class="card-text mt-2">
                    <div class="col-4 input-group border-black border-1">
                      <button
                              type="button" class="btn btn-outline-dark quantity-btn  quantity-minus">-</button>
                      <input
                              name="quantity"
                              style="width: 70px"
                              class="quantity form-control text-center flex-grow-0"
                              th:placeholder="${cartItem.getValue()}"

                              th:value="${cartItem.getValue()}"
                              readonly
                      />
                      <button type="button" class="btn btn-outline-dark quantity-btn  quantity-plus">+</button>
                    </div>
                    <a class="btn btn-outline-danger my-2" th:href="@{/carts/delete/{id}(id = ${cartItem.getKey().id})}">Delete</a>
                  </div>
                </div>
              </div>
            </div>
          </td>

          <td class="col col-4 text-end">

            <h6 class="  itemPrice " th:text="${cartItem.getKey().price * cartItem.getValue()}">EUR</h6>
          </td>


        </tr>
      </div>

      </tbody>
    </table>
  </div>

  <div class="container">

    <form action="/carts/checkout" method="post">
      <div
              class="row flex-row justify-content-center align-items-center justify-content-md-end">
        <p class="col-12 text-center text-md-end fs-5">
          Subtotal € <span th:if="${cartList.size() > 0}" class="subtotal" th:text="${cart.countTotalPayment()}"><%= String.format("%.2f", subTotal)  %></span> EUR
        </p>
        <p class="col-12 text-center text-md-end fw-light">
          Tax included and shipping calculated at checkout
        </p>
        <div th:if="${cartList.size() > 0}">
          <button
                  type="submit"
                  style="color: white"
                  class="col-8 col-md-4 btn bg-black mt-4">
            Check out
          </button>
        </div>
      </div>
    </form>

  </div>
</section>

<script>
  // for increasing quantity

  document
          .querySelector(".quantity-plus")
          .addEventListener("click", function () {
            document.querySelector(".quantity-minus").disabled = false;
            let newQuantity = document.querySelector(".quantity").value;
            let num = parseInt(newQuantity);
            num += 1;
            document.querySelector(".quantity").value = num;
            document.querySelector(".quantity").textContent = num;

            console.log(num);
          });
</script>

<script>
  // for decreasing quantity
  document
          .querySelector(".quantity-minus")
          .addEventListener("click", function () {
            let newQuantity = document.querySelector(".quantity").value;
            let num = parseInt(newQuantity);
            if (num === 1) {
              document.querySelector(".quantity-minus").disabled = true;
            } else {
              num -= 1;
              document.querySelector(".quantity").value = num;
              document.querySelector(".quantity").textContent = num;
              console.log(num);
            }
          });
</script>
<script>
  let quantity = document.querySelector(".quantity").value;
  console.log("quan" + quantity)
  let costPerItem = document.querySelector(".price").textContent;
  console.log("cost" + costPerItem)
  let totalCost = quantity * costPerItem;
  console.log("total"+ totalCost);
  let totalElement = document.querySelector(".itemPrice");

  // let quantityBtn = document.querySelector(".quantity-btn");
  let quantityPlus = document.querySelector(".quantity-plus");
  let quantityMinus = document.querySelector(".quantity-minus");


  quantityPlus.addEventListener("click", function (){
    quantity = document.querySelector(".quantity").value;
    updateTotalCost(quantity);
    updateDisplay();

  });
  quantityMinus.addEventListener("click", function (){
    quantity = document.querySelector(".quantity").value;
    updateTotalCost(quantity);
    updateDisplay();

  });

  function updateTotalCost(quantity) {
    // Recalculate the total cost based on the new quantity
    totalCost = quantity * costPerItem;
    console.log("update total " + totalCost)
  }

  function updateDisplay() {
    // Update the displayed quantity and total cost
    totalElement.textContent = totalCost.toFixed(2);
  }

</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>
</html>